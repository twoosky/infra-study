# 사용자 수에 따른 규모 확장성

## 단일 서버
* 사용자의 요청이 처리되는 과정

<img src="https://user-images.githubusercontent.com/50009240/164426609-345c3427-5587-4887-8d77-f0faa60b8605.png" height="370" width="700">

1. 사용자가 웹 브라우저에 URL(도메인 이름) 입력한다.
2. 입력된 URL 정보는 DNS에서 IP 주소로 변환되어 반환된다.
3. 해당 IP주소의 웹 서버로 HTTP 요청이 전달된다.
4. 요청을 받은 웹 서버는 HTML 페이지나 JSON 형턔의 응답을 반환한다.

## 데이터베이스
사용자가 늘면 서버 하나로는 충분하지 않아, 여러 서버를 두어야 한다.  
여러 서버를 두어 하나는 웹/모바일 트래픽 처리 용도, 다른 하나는 데이터베이스용으로 사용한다.  
서버를 분리하면 `웹 계층`과 `데이터 계층` 각각을 독립적으로 확장해 나갈 수 있게 된다.

<img src="https://user-images.githubusercontent.com/50009240/164429189-fc711995-5fb7-489a-bc1b-2204d6cb8f59.png" height="370" width="700">  

**어떤 데이터베이스를 사용할 것인가?**  
* `RDBMS`는 자료를 테이블과 열, 칼럼으로 표현한다. 여러 테이블에 있는 데이터를 조인(join)하여 합칠 수 있다.  
* `NoSQL`은 키-값 저장소, 그래프 저장소, 칼럼 저장소, 문서 저장소로 나눌 수 있다. 조인(join) 연산을 지원하지 않는다.
* `RDBMS`를 사용하는 것이 최선일 수 있지만, 아래와 같은 경우에는 `NoSQL`이 바람직한 선택일 수 있다. 
  * 아주 낮은 응답 지연시간(latency)이 요구됨
  * 다루는 데이터가 비정형이라 관게형 데이터가 아님
  * 데이터(JSON, YAML, XML 등)을 직력화하거나 역직렬화할 수 있기만 하면 됨
  * 아주 많은 양의 데이터를 저장할 필요가 있음

## 수직적 규모 확장 vs 수평적 규모 확장
`수직적 규모 확장(scale up)`: 서버에 고사양 자원(더 좋은 CPU, 더 많은 RAM 등)을 추가하는 방법이다.  
`수평적 규모 확장(scale out)`: 더 많은 서버를 추가하여 성능을 개선하는 방법이다.

수직적 확장은 아주 단순한 개념이기 때문에 적은 트래픽이 발생하는 경우 좋은 방법이 될 수 있다.  
하지만 scale up에는 심각한 단점이 존재한다.
* 한 대의 서버에 CPU나 메모리를 무한대로 증설할 방법은 없다.
* 장애에 대한 자동복구 방안이나 다중화 방안을 제시하지 않는다. 서버에 장애가 발생하면 웹사이트/앱은 완전히 중단된다.  

위와 같은 단점 때문에, ***대규모 애플리케이션을 지원하는 데는 수평적 규모 확장법***이 보다 적절하다.

## 로드밸런서
로드밸런서는 부하 분산 집합에 속한 웹 서버들에게 트래픽 부하를 고르게 분산하는 역할을 한다.  
사용자는 로드밸런서의 `공개 IP`(public IP)주소로 접속서버 간 통신에는 `사설 IP`(private IP)주소가 사용된다.

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fk.kakaocdn.net%2Fdn%2FbJpnw2%2FbtrtO7C38gQ%2F7kC7aLeThzI64aVupkt360%2Fimg.png" height="470" width="670">  

위 그림과 같이 `scale out`으로 서버를 늘려 장애를 자동복구하지 못하는 문제(no failover)를 해소할 수 있고,  
`로드밸런서의 트래픽 부하 분산`을 통해 웹 계층의 가용성을 향상시킬 수 있다.
* 서버 1에 장애가 발생하면 로드밸런서에 의해 모든 트래픽은 서버2로 전송된다. 따라서 서비스 전체가 다운되는 일을 방지할 수 있다.
* 트래픽의 가파른 증가로 인해 서버 리소스가 부족하다면, `scale out`으로 더 많은 서버를 추가하면 된다.  
그러면 로드밸런스가 자동적으로 트래픽을 분산시켜준다.

## 데이터베이스 다중화
여러 대의 서버가 하나의 데이터베이스로 READ/WRITE 요청을 한다면 데이터 계층에 부하가 발생하므로 데이터베이스 다중화가 필요하다.  
`데이터베이스 다중화`: 서버 사이에 master-slave 관계를 설정하고 데이터 원본은 주서버에, 사본은 부 서버에 저장하는 방식이다.  
* 주(master) 서버: 쓰기 연산, 데이터 원본을 갖는다.
* 부(slave) 서버: 읽기 연산, master 데이터베이스로부터 사본을 전달받아 저장한다. 
* 대부분의 애플리케이션은 읽기 연산의 비중이 훨씬 크기 때문에 일반적으로 부(slave) 데이터베이스의 수가 더 많다.

<img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fk.kakaocdn.net%2Fdn%2FBuXkV%2FbtrtO8hHFKN%2FMD5YhUkbVoHCf5ck2iowhK%2Fimg.png" height="500" width="600">

**데이터베이스 다중화 이점**
* `더 나은 성능`: write/update와 같은 데이터 변경 연산은 `master` 데이터베이스 서버로만 전달되고, 읽기 연산은 `slave`로 분산된다. 병렬 처리될 수 있는 질의(query)의 수가 늘어나므로 성능이 향상된다.
* `안정성`: 데이터를 물리적으로 떨어진 여러 장소에 다중화시켜 놓을 수 있으므로, 데이터베이스 서버 일부가 파괴되어도 데이터는 보존된다.
* `가용성`: 데이터를 여러 slave 서버에 복제해 둠으로써, 하나의 데이터베이스 서버에 장애가 발생해도 다른 서버의 데이터를 가져와 게속 서비스할 수 있다.


