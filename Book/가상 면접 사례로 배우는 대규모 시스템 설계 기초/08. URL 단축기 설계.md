# URL 단축기 설계

## 기본적인 기능
* URL 단축: 주어진 긴 URL을 훨씬 짧게 줄인다.
* URL 리디렉션: 축약된 URL로 HTTP 요청이 오면 원래 URL로 안내
* 높은 가용성과 규모 확장성, 장애 감내 필요

## API 엔드포인트
클라이언트는 서버가 제공하는 API 엔드포인트를 통해 서버와 통신한다.  
엔드포인트를 REST 스타일로 설게할 것이다.  
URL 단축키는 기본적으로 두 개의 엔드포인트를 필요로 한다.  
* URL 단축용 엔드포인트
  *  새 단축 URL을 생성하고자 하는 클라이언트는 엔드포인트에 단축할 URL을 인자로 실어서 POST 요청을 보낸다.
  ```
  POST /api/v1/data/shorten
  인자: {longUrl: longURLString}
  반환: 단축된 URL
  ```
* URL 리디렉션용 엔드포인트
  * 단축 URL로 HTTP 요청이 오면, 원래 URL로 보내주기 위한 용도의 endpoint
  ```
  GET /api/v1/shortUrl
  반환: HTTP Redirection의 목적지가 될 원래의 URL
  ```
  
## URL 리디렉션
클라이언트로 부터 단축 URL을 받은 서버는 단축 URL을 원래 URL로 바꾸어 301 응답의 Location 헤더에 넣어 반환한다.  

<img src="https://github.com/sang-w0o/Study/blob/master/images/SDI_URLS_1.png"  width="400" height="450">

* `301 Permanently Moved`
  * 해당 URL에 대한 HTTP 요청의 처리 책임이 영구적으로 Location 헤더에 반환된 URL로 이전되었다는 응답이다.
  * 영구적으로 이전되었으므로 브라우저는 이 응답을 caching한다.
  * 따라서 추후 같은 단축 URL에 요청을 보낼 필요가 있을 때 브라우저는 cache된 원래의 URL로 요청을 보내게 된다.
  * 장점: 첫번째 요청만 단축 URL 서버로 전송되므로 서버 부하를 줄일 수 있다.
* `302 FOUND`
  * 주어진 URL로의 요청이 *일시적으로* Location 헤더가 지정하는 URL에 의해 처리되어야 한다는 응답이다.
  * 클라이언트의 요청은 항상 단축 URL 서버에 먼저 보내진 후 원래 URL로 리디렉션 되어야 한다.
  * 장점: 클릭 발생률, 발생 위치 추적 등 트래픽 분석에 유리하다.



**Hash Table**  
URL 리디렉션을 구현하는 가장 직관적인 방법이다.  
Hash Table에 `<단축 URL, 원래 URL>`의 쌍을 저장해 아래와 같이 URL 리디렉션을 구현할 수 있다.  
1. 원래 URL = `hashTable.get(단축 URL)
2. 301 또는 302 응답 Location header에 원래 URL을 넣은 후 전송

